<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"><link rel="icon" type="image/png" href="/favicon.png" sizes="16x16"><link rel="stylesheet" href="/style.css"><link rel="preload" href="/assets/NotoSerif-Regular-smol.woff2" as="font" type="font/woff2" crossorigin="true"><link rel="preload" href="/assets/NotoSerif-Bold-smol.woff2" as="font" type="font/woff2" crossorigin="true"><title>üåà Building a rainbow - David Bos</title></head><body class="basic-main"><header class="navigation-bar"><div id="nav-status"><img id="img-default" src="/assets/post-default.png" alt="" width="48" height="48" style="image-rendering: pixelated;"><img id="img-hover" src="/assets/post-hover.png" alt="" width="48" height="48" style="image-rendering: pixelated;"></div><nav><a href="/">HOME</a><a href="/posts">POSTS</a></nav></header><div><main><article class="post-article"><header><h1>üåà Building a rainbow</h1><span id="published">Published on <time>16 January 2026</time></span></header><p>We are going to generate an image of the human visible color spectrum. Not quite a rainbow, but very colorful either way!</p><p>But first: what determines the perceived color of light? That would be <a class="main-link" href="https://en.wikipedia.org/wiki/Cone_cell">cone cells</a> in your eyes, these are cells sensitive to light. A typical human has three different kinds of cone cells, that respond differently based on the wavelength of the light that hits the cell. The combined activation of these cone cells determines the perceived color.</p><h2>Get human color vision data</h2><p>The human color vision data we will use is <a class="main-link" href="https://cie.co.at/datatable/cie-1931-colour-matching-functions-2-degree-observer">publicly available</a> and was originally published in 1931 (almost 100 years ago!). It is a mapping of wavelengths (in nm) to three values defining the <a class="main-link" href="https://en.wikipedia.org/wiki/CIE_1931_color_space#CIE_XYZ_color_space">CIE XYZ color space</a> and was gathered through a series of experiments where people had to match colors.</p><p>Note that the three values are <em>not</em> activation values of the three different cone cells. You can still think of the values as some other kind of light sensitive sensors. The values produced by the mapping are called tristimulus values X, Y and Z. Y is an important value as it encodes the brightness.</p><h2>Normalize XYZ values</h2><p>We will normalize our tristimulus relative to a <a class="main-link" href="https://en.wikipedia.org/wiki/Standard_illuminant">standard illuminant</a>. There are different such illuminants, but we will use D65 (usually assumed choice). Each standard illuminant is defined by a spectral power distribution which basically describes how much light at each wavelength that illuminant emits. This data is also <a class="main-link" href="https://cie.co.at/datatable/cie-standard-illuminant-d65">available for download</a>.</p><p>We are going to integrate over this spectral power distribution to find the Y value for the D65 illuminant. This Y value encodes the brightness of D65 and we will accept it as unit brightness. To integrate we take all the D65 powers between 360 nm and 830 nm and multiply them with the y values from the CIE 1931 data between 360 nm and 830 nm, and then sum them.</p><p>Interestingly, the XYZ data goes over a range of 360 to 830 nm, but the D65 data starts at 300 nm. So if you want to integrate yourself, make sure to map to the right wavelengths and not assume that both start at the same wavelength.</p><p>Also, even though the CIE XYZ data goes from 360 nm to 830 nm, we can only see wavelengths between approximately 380 nm and 700 nm. This means that the sides of our spectrum should be black in the end.</p><h2>Convert XYZ to sRGB</h2><p>Lucky for us, a <a class="main-link" href="https://en.wikipedia.org/wiki/SRGB#Primaries">CIE XYZ to sRGB mapping</a> is readily available in the form of a matrix! According to Wikipedia, the X, Y, and Z values must be scaled such that the Y of D65 is 1.0. Good thing we already did this ‚ò∫Ô∏è</p><p>Also, the RGB color after the matrix multiplication is "linear", but RGB colors are not actually saved in this format for sRGB. You still need to apply so called <a class="main-link" href="https://en.wikipedia.org/wiki/SRGB#Transfer_function_(%22gamma%22)">gamma correction</a>. This changes how brightness values are distributed: instead of evenly spaced (linearly), more precision is given to dark values and less precision to bright values.</p><h2>Lo and behold</h2><p>If we now render our spectrum it would be black, because the wavelength emissions are too weak. Remember that we are rendering light of a single wavelength, each with only a power of 1. This is very weak compared to our reference D65 illuminant. In order to get something visible we just have to increase the power. I have chosen 4,000 because it gives a nice, bright image without capping out any RGB channels. Now, we can finally see our beautiful, spectral rainbow in all its glory!</p><figure><img src="/assets/rainbow.png" width="471" height="81" style="align-self: center;"><figcaption>Wavelengths from 360 nm to 830 nm rendered as RGB colors.</figcaption></figure><h2>Corrections</h2><p>Actually, this image is not an accurate representation of the perceived color of each wavelength. Almost no purely spectral color can be displayed with sRGB. After the mapping from XYZ to RGB some of the channels will be negative, but we cannot display negative RGB values. A little disappointing üòî These values I clamped to 0, so that they are as close as possible to being accurate, but they will not look the same as real monochromatic light.</p><h2>Afterthoughts</h2><p>You can use <a class="main-link" href="/assets/visible_spectrum.py">this Python script</a> to generate the image yourself.</p><p>This colorspace stuff is pretty complicated, man.</p></article></main></div><ul class="contact-information"><li><a href="https://www.github.com/toteload">Github</a></li><li><a href="mailto:me@davidbos.me">email address</a></li></ul></body></html>